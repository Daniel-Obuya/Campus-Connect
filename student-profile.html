<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Profile - Campus Connect</title>
    <link rel="stylesheet" href="common-header.css">
    <link rel="stylesheet" href="dashboard_styles.css">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5deb3 0%, #deb887 50%, #cd853f 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        .profile-container {
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255,193,7,0.18);
            border-radius: 28px;
            padding: 48px 48px 32px 48px;
            width: 100%;
            max-width: 850px;
            box-shadow: 0 12px 32px rgba(205,133,63,0.13);
            margin-top: 32px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 32px;
            border-bottom: 1px solid rgba(205,133,63,0.10);
            padding-bottom: 20px;
        }
        .profile-header-info h1 {
            font-size: 2.1rem;
            color: #7c4a03;
            font-weight: 700;
            margin-bottom: 6px;
        }
        .profile-header-info p {
            font-size: 1.1rem;
            color: #8b6f3d;
        }
        .profile-section {
            margin-bottom: 36px;
        }
        .profile-section h2 {
            font-size: 1.3rem;
            color: #a05a00;
            margin-bottom: 14px;
            border-bottom: 1px solid #ffe0b2;
            padding-bottom: 7px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .profile-section h2 i {
            color: #ff9800;
        }
        .profile-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 10px 14px;
            margin-bottom: 10px;
            width: 100%;
        }
        .profile-details .detail-item {
            font-size: 1rem;
            color: #4d3a1a;
            background: rgba(255,255,255,0.97);
            border-radius: 10px;
            padding: 10px 14px;
            box-shadow: 0 2px 8px rgba(255,193,7,0.09);
            display: flex;
            align-items: center;
            gap: 8px;
            word-break: break-word;
            min-width: 0;
            max-width: 100%;
            transition: box-shadow 0.2s, background 0.2s;
        }
        .profile-details .detail-item:hover {
            background: #fff8e1;
            box-shadow: 0 4px 16px rgba(255,193,7,0.13);
        }
        @media (max-width: 600px) {
            .profile-details {
                grid-template-columns: 1fr;
            }
        }
        .profile-details .detail-item i {
            color: #ff9800;
            font-size: 1.2em;
        }
        .profile-details .detail-item strong {
            color: #a05a00;
            min-width: 120px;
            font-weight: 600;
        }
        .about-me p {
            font-size: 1.08rem;
            color: #5a4a2c;
            line-height: 1.7;
            background: rgba(255,255,255,0.7);
            border-radius: 10px;
            padding: 16px 20px;
            margin-top: 0;
        }
        .content-list {
            list-style: none;
            padding-left: 0;
        }
        .content-list li {
            background: rgba(255,255,255,0.13);
            border: 1px solid #ffe0b2;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .content-list li:hover {
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 6px 16px rgba(255,193,7,0.13);
        }
        .content-list h3 {
            font-size: 1.1rem;
            color: #a05a00;
            margin-bottom: 5px;
        }
        .content-list p {
            font-size: 0.98rem;
            color: #6d5a3a;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .content-list .action-btn {
            padding: 8px 15px;
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            border: none;
            border-radius: 8px;
            font-size: 0.98rem;
            font-weight: 500;
            color: #333;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.3s;
            display: inline-block;
        }
        .content-list .action-btn:hover {
            background: #ff9800;
        }
        .placeholder-message {
            font-style: italic;
            color: #a08a5a;
            margin-top: 20px;
            text-align: center;
        }
        .edit-profile-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 13px 28px;
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            border: none;
            border-radius: 12px;
            font-size: 1.08rem;
            font-weight: 700;
            color: #333;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
            text-align: center;
            box-shadow: 0 2px 8px rgba(255,193,7,0.13);
        }
        .edit-profile-btn:hover {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 4px 14px rgba(255,193,7,0.18);
        }
    </style>
</head>
<body>
    <header class="header">
        <span class="app-name">Campus Connect</span>
        <div>
            <a href="student_dashboard.html" class="btn-header btn-header-secondary">Back to Dashboard</a>
            <a href="/welcome" class="btn-header btn-header-danger" id="logoutButton">Logout</a>
        </div>
    </header>

    <div class="profile-container">
        <div class="profile-header">
            <!-- Profile picture removed for UI consistency -->
            <div class="profile-header-info">
                <h1 id="studentName">[Student Name]</h1>
                <p id="welcomeMessage">Student at Campus Connect</p>
            </div>
        </div>

        <div class="profile-section">
            <h2><i class="fas fa-user-circle"></i> Personal Information</h2>
            <div class="profile-details">
                <div class="detail-item"><i class="fas fa-envelope"></i><strong> Email:</strong> <span id="studentEmail">[Student Email]</span></div>
                <div class="detail-item"><i class="fas fa-book-open"></i><strong> Major:</strong> <span id="studentMajor">[Major]</span></div>
                <div class="detail-item"><i class="fas fa-graduation-cap"></i><strong> Graduation Year:</strong> <span id="studentGradYear">[Graduation Year]</span></div>
                <div class="detail-item"><i class="fab fa-linkedin"></i> LinkedIn: <span id="studentLinkedIn"></span></div>
                <div class="detail-item"><i class="fab fa-github"></i> GitHub: <span id="studentGithub"></span></div>
            </div>
        </div>

        <div class="profile-section about-me">
            <h2><i class="fas fa-info-circle"></i> About Me</h2>
            <p id="studentBio">This is a placeholder for the student's biography. They can share a bit about their interests, academic goals, or anything else they'd like to share with the community. This section can be updated via the 'Edit Profile' page.</p>
        </div>

        
        <div class="profile-section">
            <h2><i class="fas fa-calendar-check"></i> My Registered Events</h2>
            <ul class="content-list" id="registeredEventsList">
                <!-- Student's registered events will be populated here by JavaScript -->
                <li><p class="placeholder-message">Loading your registered events...</p></li>
            </ul>
        </div>

        <div class="profile-section">
            <h2><i class="fas fa-users"></i> My Joined Clubs</h2>
            <ul class="content-list" id="joinedClubsList">
                <!-- Student's joined clubs will be populated here by JavaScript -->
                <li><p class="placeholder-message">Loading your joined clubs...</p></li>
            </ul>
        </div>

        <div class="profile-section">
            <h2><i class="fas fa-project-diagram"></i> My Active Projects</h2>
            <ul class="content-list" id="myActiveProjectsList">
                <!-- Student's active projects will be populated here by JavaScript -->
                <li><p class="placeholder-message">Loading your active projects...</p></li>
            </ul>
        </div>

        <div style="text-align: center;">
            <a href="#" class="edit-profile-btn" id="editProfileButton">Edit Profile</a>
        </div>

        <p class="placeholder-message">More profile features and information will be available here soon.</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser && currentUser.role === 'student') {
                document.getElementById('studentName').textContent = `${currentUser.firstName || 'Student'} ${currentUser.lastName || ''}`;
                document.getElementById('studentEmail').textContent = currentUser.email || 'N/A';
                document.getElementById('studentBio').textContent = currentUser.bio || 'No biography provided yet. You can add one by editing your profile.';

                // Get major and graduation year from main user object if present
                document.getElementById('studentMajor').textContent = currentUser.major || (currentUser.studentDetails && currentUser.studentDetails.major) || 'N/A';
                document.getElementById('studentGradYear').textContent = currentUser.graduation_year || (currentUser.studentDetails && currentUser.studentDetails.graduationYear) || 'N/A';

                // LinkedIn and GitHub from user_profiles (if available)
                if (currentUser.userProfile) {
                    document.getElementById('studentLinkedIn').innerHTML = currentUser.userProfile.linkedin_url
                        ? `<a href="${currentUser.userProfile.linkedin_url}" target="_blank">${currentUser.userProfile.linkedin_url}</a>`
                        : 'N/A';
                    document.getElementById('studentGithub').innerHTML = currentUser.userProfile.github_url
                        ? `<a href="${currentUser.userProfile.github_url}" target="_blank">${currentUser.userProfile.github_url}</a>`
                        : 'N/A';
                } else {
                    document.getElementById('studentLinkedIn').textContent = 'N/A';
                    document.getElementById('studentGithub').textContent = 'N/A';
                }

                populateRegisteredEvents(currentUser);
                populateJoinedClubs(currentUser);
                populateMyActiveProjects(currentUser);
                // TODO: Fetch and populate "Collaborative Projects" (projectsList) if it's for discovery
                // fetchProjectsToCollaborate(); 
            } else {
                // If no user data, or not a student, redirect to login
                window.location.href = '/login-student';
            }

            document.getElementById('logoutButton').addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('authToken');
                localStorage.removeItem('currentUser');
                window.location.href = '/welcome';
            });

            document.getElementById('editProfileButton').addEventListener('click', function(e) {
                e.preventDefault();
                // You'll need to create an edit-profile.html page
                window.location.href = '/edit-student-profile'; // Redirect to the edit profile page
            });
        });

        function populateRegisteredEvents(user) {
            const eventsList = document.getElementById('registeredEventsList');
            eventsList.innerHTML = ''; // Clear existing placeholders

            if (user.registeredEvents && user.registeredEvents.length > 0) {
                user.registeredEvents.forEach(event => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <h3>Registered: ${event.name || 'Unnamed Event'}</h3>
                        <p>Status: ${event.status || 'N/A'} | Date: ${event.date || 'N/A'}</p>
                        <a href="#" onclick="viewEventDetails(${event.id || 0}); return false;" class="action-btn" style="margin-top:5px;">View Details</a>
                    `;
                    eventsList.appendChild(li);
                });
            } else {
                eventsList.innerHTML = '<li><p class="placeholder-message">You haven\'t registered for any events yet.</p></li>';
            }
        }

        function populateJoinedClubs(user) {
            const clubsList = document.getElementById('joinedClubsList');
            clubsList.innerHTML = ''; // Clear existing placeholders

            if (user.joinedClubs && user.joinedClubs.length > 0) {
                user.joinedClubs.forEach(club => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <h3>Member: ${club.name || 'Unnamed Club'}</h3>
                        <p>Role: ${club.role || 'Member'}</p>
                        <a href="#" onclick="navigateToClub('${club.id || ''}'); return false;" class="action-btn" style="margin-top:5px;">Go to Club Page</a>
                    `;
                    clubsList.appendChild(li);
                });
            } else {
                clubsList.innerHTML = '<li><p class="placeholder-message">You haven\'t joined any clubs yet. Explore the clubs directory!</p></li>';
            }
        }

        function populateMyActiveProjects(user) {
            const myProjectsList = document.getElementById('myActiveProjectsList');
            myProjectsList.innerHTML = ''; // Clear existing placeholders

            if (user.activeProjects && user.activeProjects.length > 0) {
                user.activeProjects.forEach(project => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <h3>${project.name || 'Unnamed Project'}</h3>
                        <p>Your Role: ${project.role || 'Contributor'}</p>
                        ${project.detailsLink ? `<a href="${project.detailsLink}" class="action-btn" style="margin-top:5px;">View Project</a>` : ''}
                    `;
                    myProjectsList.appendChild(li);
                });
            } else {
                myProjectsList.innerHTML = '<li><p class="placeholder-message">You are not currently active in any projects. Find one to collaborate on!</p></li>';
            }
        }

        // Placeholder for fetching projects available for collaboration
        // async function fetchProjectsToCollaborate() { /* ... populate #projectsList ... */ }


        // Placeholder functions for interactions - to be implemented with API calls
        function viewEventDetails(eventId) {
            alert(`Redirecting to details for event ID: ${eventId}. (Page to be implemented)`);
            // Example: window.location.href = `/event-details?id=${eventId}`;
            // Registration would happen on the event details page.
        }

        function viewAnnouncement(announcementId) {
            alert(`Displaying full announcement ID: ${announcementId}. (Modal or page to be implemented)`);
            // Example: Show a modal with announcement content or navigate to a page
            // showAnnouncementModal(announcementId);
        }

        function navigateToClub(clubId) {
            // This is a conceptual function. If your clubs directory can deep link, use that.
            // Otherwise, it just goes to the main directory.
            alert(`Navigating to club: ${clubId}. (Functionality depends on clubs directory)`);
            window.location.href = `/clubs-directory#${clubId}`; // Example deep link
        }


        function collaborateProject(projectId) {
            alert(`Expressing interest in project ID: ${projectId}. (Backend not implemented)`);
            // TODO: API call to collaborate on project
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script> <!-- Font Awesome for icons -->
</body>
</html>