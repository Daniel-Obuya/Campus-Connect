<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - Campus Connect</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="dashboard_styles.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="floating-icons-container">
        <div class="floating-icon icon1"></div>
        <div class="floating-icon icon2"></div>
        <div class="floating-icon icon3"></div>
        <div class="floating-icon icon4"></div>
        <div class="floating-icon icon5"></div>
        <div class="floating-icon icon6"></div>
    </div>

    <header class="main-header">
        <div class="header-left">
            <img src="images/logo 1.png" alt="Campus Connect Logo" class="logo">
            <div class="brand-name">Campus Connect</div>
        </div>
        <nav class="main-nav">
            <a href="events_directory.html" class="nav-link">
                <i class="fas fa-calendar-alt nav-icon"></i> Events
            </a>
            <a href="interactive_calendar.html" class="nav-link">
                <i class="fas fa-calendar-days nav-icon"></i> Calendar
            </a>
            <a href="projects_directory.html" class="nav-link">
                <i class="fas fa-project-diagram nav-icon"></i> Projects
            </a>
            <a href="departments_directory.html" class="nav-link">
                <i class="fas fa-building nav-icon"></i> Departments
            </a>
            <a href="clubs-directory.html" class="nav-link">
                <i class="fas fa-users nav-icon"></i> Clubs
            </a>
        </nav>
        <div class="header-right">
            <div id="notification-icon" class="notification-wrapper">
                <span class="bell-icon"><i class="fas fa-bell"></i></span>
                <span id="notification-count" class="notification-count">0</span>
            </div>
            <div class="profile-dropdown-container">
                <button class="profile-dropdown-toggle" id="profileDropdownToggle">
                    <img src="images/default-avatar.png" alt="Profile Picture" class="profile-avatar-header-small" id="headerProfilePic">
                    <i class="fas fa-caret-down"></i>
                </button>
                <div class="profile-dropdown-menu" id="profileDropdownMenu">
                    <a href="student-profile.html" class="dropdown-item"><i class="fas fa-user-circle"></i> My Profile</a>
                    <a href="#" id="logoutButton" class="dropdown-item"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            </div>
        </div>
    </header>

    <main class="dashboard-grid">
        <section id="profile-completion-widget" class="dashboard-widget profile-widget">
            <div class="widget-header">
                <h2>
                    <span class="widget-icon">ðŸ“Š</span>
                    Profile Completion
                </h2>
            </div>
            <div class="progress-bar-container" title="Complete your profile to unlock full features!">
                <div id="profile-progress" style="width: 0%">
                    <span class="progress-text">0%</span>
                </div>
            </div>
            <p class="widget-action">
                <a href="edit-student-profile.html" class="action-link">
                    Complete your profile
                    <span class="arrow">â†’</span>
                </a>
            </p>
        </section>

        <section id="personalized-feed" class="dashboard-widget feed-widget">
            <div class="widget-header">
                <h2>
                    <span class="widget-icon"><i class="fas fa-rss"></i></span>
                    Latest Announcements
                </h2>
            </div>
            <div class="widget-content loading-state">
                <div class="loading-spinner"></div>
                <p>Loading feed...</p>
            </div>
        </section>

        <aside class="sidebar-widgets">
            <section id="events-calendar-widget" class="dashboard-widget calendar-widget">
                <div class="widget-header">
                    <h2>
                        <span class="widget-icon"><i class="fas fa-calendar-alt"></i></span>
                        Upcoming Events
                    </h2>
                </div>
                <div class="widget-content">
                    <p class="widget-description">Here are a few of your upcoming events. View the full calendar or browse the directory for more.</p>
                    <ul class="upcoming-events-list" id="upcoming-events-preview">
                        <!-- Events will be dynamically loaded here by JavaScript -->
                        <li class="placeholder-item">Loading events...</li>
                        <!-- Example static items (will be replaced by JS) -->
                        <!-- <li>
                            <span class="event-date">SEP 15</span>
                            <span class="event-title">Campus Coding Workshop</span>
                        </li>
                        <li>
                            <span class="event-date">SEP 20</span>
                            <span class="event-title">University Art Fair</span>
                        </li>
                        <li>
                            <span class="event-date">SEP 23</span>
                            <span class="event-title">Guest Lecture: AI in Business</span>
                        </li> -->
                    </ul>
                    <div class="widget-actions-container">
                        <a href="interactive_calendar.html" class="action-button">View Full Calendar</a>
                        <a href="events_directory.html" class="action-button">Browse All Events</a>
                    </div>
                </div>
            </section>

            <section id="recent-announcements" class="dashboard-widget announcements-widget">
                <div class="widget-header">
                    <h2>
                        <span class="widget-icon"><i class="fas fa-bullhorn"></i></span>
                        Recent Announcements
                    </h2>
                </div>
                <div class="widget-content loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading announcements...</p>
                </div>
            </section>
        </aside>

        <section id="project-showcase-quick-access" class="dashboard-widget projects-widget">
            <div class="widget-header">
                <h2>
                    <span class="widget-icon"><i class="fas fa-rocket"></i></span>
                    Project Showcase
                </h2>
            </div>
            <p class="widget-description">Discover amazing student projects and showcase your own work.</p>
            <p class="widget-action">
                <a href="projects_directory.html" class="action-link">
                    View All Projects
                    <span class="arrow">â†’</span>
                </a>
            </p>
        </section>

        <section id="discover-clubs-widget" class="dashboard-widget clubs-widget">
            <div class="widget-header">
                <h2>
                    <span class="widget-icon"><i class="fas fa-users"></i></span>
                    Discover Clubs
                </h2>
            </div>
            <p class="widget-description">Explore a wide range of student clubs and organizations. Find your community!</p>
            <a href="clubs-directory.html" class="action-button">
                <span>View All Clubs</span>
                <span class="button-arrow">â†’</span>
            </a>
        </section>

        <section id="explore-departments-widget" class="dashboard-widget departments-widget">
            <div class="widget-header">
                <h2>
                    <span class="widget-icon"><i class="fas fa-building"></i></span>
                    Departments
                </h2>
            </div>
            <p class="widget-description">Explore the academic departments and their offerings.</p>
            <a href="departments_directory.html" class="action-button">
                <span>View All Departments</span>
                <span class="button-arrow">â†’</span>
            </a>
        </section>

        <div id="notification-center-panel" class="notification-panel">
            <div class="notification-header">
                <h3>Notifications</h3>
                <button class="close-notifications">âœ•</button>
            </div>
            <ul id="notification-list"></ul>
        </div>
    </main>

    <footer>
        <p>&copy; Campus Connect <span id="current-year"></span></p>
    </footer>

    <script src="dashboard_script.js"></script>
    <!-- Main Dashboard Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const welcomeMessageElement = document.getElementById('welcome-message');
            const headerProfilePic = document.getElementById('headerProfilePic');
            const profileDropdownToggle = document.getElementById('profileDropdownToggle');
            const profileDropdownMenu = document.getElementById('profileDropdownMenu');
            const logoutButton = document.getElementById('logoutButton');

            let currentUser = null;

            try {
                // Attempt to get user data from localStorage
                currentUser = JSON.parse(localStorage.getItem('currentUser'));
            } catch (e) {
                console.error('Error parsing user data from localStorage:', e);
                // If data is corrupted, treat as not logged in
            }

            // Check if a valid student user is logged in
            if (currentUser && currentUser.role === 'student' && currentUser.firstName) {
                if (welcomeMessageElement) { // Check if element exists before using it
                    welcomeMessageElement.textContent = `Welcome, ${currentUser.firstName}! ðŸ‘‹`;
                }
                // Display profile picture in the header dropdown toggle
                if (headerProfilePic && currentUser.profilePictureUrl) {
                    headerProfilePic.src = currentUser.profilePictureUrl;
                } else if (headerProfilePic) {
                    headerProfilePic.src = 'images/default-avatar.png'; // Fallback to default if no URL
                }
            } else {
                // If not logged in or not a student, redirect to the login page
                console.warn('No valid student user found. Redirecting to login.');
                window.location.href = '/login-student.html';
                return; // Stop script execution
            }
            
            // Add entrance animation for welcome message
            if (welcomeMessageElement) { // Check if element exists before using it
                welcomeMessageElement.style.opacity = '0';
                welcomeMessageElement.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    welcomeMessageElement.style.transition = 'all 0.6s ease';
                    welcomeMessageElement.style.opacity = '1';
                    welcomeMessageElement.style.transform = 'translateY(0)';
                }, 100);
            }

            // Dropdown toggle functionality
            profileDropdownToggle.addEventListener('click', function() {
                profileDropdownMenu.classList.toggle('show');
            });

            // Close the dropdown if the user clicks outside of it
            window.addEventListener('click', function(event) {
                if (!profileDropdownToggle.contains(event.target) && !profileDropdownMenu.contains(event.target)) {
                    profileDropdownMenu.classList.remove('show');
                }
            });

            // Logout functionality (now attached to the dropdown item)
            logoutButton.addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('authToken');
                localStorage.removeItem('currentUser');
                window.location.href = '/welcome.html'; // Redirect to a neutral welcome page
            });

            // Placeholder for fetching and populating data (from dashboard_script.js)
            // These functions would typically be defined in dashboard_script.js
            // and called here after user authentication.
            // Example:
            // fetchProfileCompletion(currentUser);
            // fetchAnnouncements(currentUser);
            // fetchUpcomingEvents(currentUser);
        });
    </script>
</body>
</html>